Roteiro Geração e Atualização do Instalador + checklist ANTES da instalação em um fornecedor novo 
==================================================================================================
    1. Atualizar o único /conf/.properties file no diretório da instalação 
       C:\PCronos\Integração Fornecedor - Portal Cronos\Instalador\Windows\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\conf\.
        Executar Maven para atualizar integr-fornecedor-x.y.z.jar.

	2. Conectar no Team Viewer
	
	   Skype:
	   Existem 2 tipos de instalação do Team Viewer: "free" (pessoal) e "trial"/pago (empresarial). 
Meu Team Viewer é "free" e pessoal então não consigo conectar com seu Team Viewer empresarial. 
Você quer desinstalar sua versão "trial" (ou pago?) e instalar a versão "free" do Team Viewer? 
Caso contrário, sugiro instalar o AnyDesk, que é sempre de graça. 
Como última opção vou falar com Leão para ele pagar a licença do Team Viewer empresarial. 
Como vai ser?

	
		Skype:
		Quando você desocupar o servidor, me avise


	3. a. Verificar se o usuário logado é administrador ou administrator, 
	      local ou da rede (como administrador da rede ainda não foi testado).
	      (Formaggio: user "techcorp")
	      
	   b. Nas opções do Windows Explorer marcar "Exibir Arquivos do Sistema e Arquivos Ocultos". 
	      Fechar e re-abrir o Windows Explorer. Senão, vai pensar indevidamente que não existe o dir 
	      C:\ProgramData\ por exemplo............. 
	
	4. No arquivo "Primeira_Instalacao_Versao_Windows.bat" : 
		- Verificar a versão de Windows no servidor do fornecedor 
		  e descomentar a variável "osVersion" correta no início do .bat. 
		  CMD: winver
		  ou:  systeminfo | findstr OS
		  
		- Verificar a variável "tipoOS=32" ou "tipoOS=64" no .bat
		
		- Se a versão de Windows ainda não está homologada, 
		  comentar "regedit.exe /s %arquivoRegedit%" no  "if %tipoOS% == 64" ou "32".		  
		  CUIDADO PARA NÃO CORROMPER O REGEDIT !!!!!!!!!
		  CUIDADO PARA NÃO CORROMPER O REGEDIT !!!!!!!!!
		  CUIDADO PARA NÃO CORROMPER O REGEDIT !!!!!!!!!
		  
		  Também comentar :
		  	) 
		  	REM else (
			REM     echo MSGBOX "Esta versão de Windows ainda não está suportada ! Favor entrar em contato com o Suporte do Portal Cronos." > %temp%\TEMPmessage.vbs
    		REM 	call %temp%\TEMPmessage.vbs
			REM     del %temp%\TEMPmessage.vbs /f /q
			REM     exit
			REM )
			
		  Observação ; depois de "REM" deve ter pelo menos UM espaço em branco !!!!!

		- Verificar a variável "set drive=C:"  ou "set drive=D:" no início de Primeira_Instalacao_Versao_Windows.bat 
		  Verificar se tem espaço livre de 1 GB nos discos C:/, D:/, etc. :
			- 303 MB: 
				- C:\Arquivos de Programas PC\*
				- C:\Program Files\Java\jre1.8.0_92\*
				- C:\temp\Instalar Integração Fornecedores - Portal Cronos.exe
			- 250 MB: 
			    - C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\hs_err_pidxxxx.mdmp
			- 450 MB: (Prolac: 30 MB por mês)
				- C:\ProgramData\PortalCronos\Logs\Local\*.xml  (estimativa inicial do tamanho de 1 ano de arquivos de XML)
				- C:\ProgramData\PortalCronos\Logs\Local\*.log  (estimativa inicial do tamanho de 1 ano de arquivos de XML)

		  
		- Verificar se precisa descomentar um dos seguintes skips no início de Primeira_Instalacao_Versao_Windows.bat :
						REM goto SKIP_JRE
						REM goto SKIP_JRE_TEMPDIR
						REM goto SKIP_JRE_TEMPDIR_PROGRAMDIR
						REM goto SKIP_JRE_TEMPDIR_PROGRAMDIR_TASK
		  e verificar eventuais outros goto´s 
 
 
    5a. No FornecedorRepositorio.java, método getFornecedor(), adicionar o fornecedor novo 
        e preencher TODOS os campos sem falta, antes de continuar, pois sem isso a instalação do 
        Manual de Manutenção para a TI não vai funcionar corretamente.
        
    5b. Compilar e atualizar integr-fornecedor-x.y.z.jar 
        (no diretório ...\Instalador\Windows\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\)
          
    6. NUNCA MAIS PULAR ESTE PASSO (por causa da geração do Manual de Manutenção para a TI): 
       Regerar o instalador, veja o "Manual para a geração do instalador Setup.exe" abaixo.
    
    7. O instalador deve ser copiado para exatamente o diretório C:\temp\ no servidor do fornecedor.
       Se for outro diretório, ajustar este diretório no final de Primeira_Instalacao_Versao_Windows.bat.
    
    8. Antes da instalação :
       					        
          0. Primeiro fazer backup (no arquivo "Backup variáveis de ambiente do sistema Path de Windows.txt"):
                (i)  do variável de ambiente do sistema "Path" de Windows: 
                (ii) do diretório  C:\ProgramData\Oracle\Java\javapath\
                
             e verificar :
              
       	  1. se já tinha C:\ProgramData\Oracle\Java\javapath\ na primeira posição no PATH antes da minha instalação
       	       (i)   no variável de ambiente do usuário administrador
       	       (ii)  no variável de ambiente do sistema
     	  2. se tem outro caminho de java no PATH e se java.exe se encontra em um dos caminhos do PATH, 
     	     por exemplo em C:\WINDOWS\System\
       	       (i)   no variável de ambiente do usuário administrador
       	       (ii)  no variável de ambiente do sistema
     	  3. No caso que já tinha um C:\ProgramData\Oracle\Java\javapath\ no servidor, fazer backup dos atalhos atuais 
     	     antes da instalação.
       	       (i)   do variável de ambiente do usuário administrador
       	       (ii)  do variável de ambiente do sistema

       No caso que no servidor do fornecedor já tem outra versão mais antiga do JRE instalada na mesma maquina, 
       depois da instalação remover C:\ProgramData\Oracle\Java\javapath\ na primeira posição no PATH, se não tinha antes. 
       Isso é para evitar que programas de terceiros param de funcionar corretamente.

       No caso que no servidor do fornecedor já tinha outra versão mais nova do JRE instalada na mesma maquina, 
       após a instalação voltar os atalhos em C:\ProgramData\Oracle\Java\javapath\ para como estava antes.

 
    9. Após a instalação :
    
    9a. Verificar e comparar o variável de ambiente do sistema "Path" de Windows
    
    9b. Restaurar o backup de C:\ProgramData\Oracle\Java\javapath\, no caso.
     
     
    9c. Nos seguintes casos:
             1. no caso de versões de Windows que ainda não estão em nenhuma das duas listas abaixo;
             2. no caso de versões de Windows que estão com o bug abaixo: 
             
        Corrigir as seguintes chaves manualmente no regedit :
          [HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java Runtime Environment\1.8.0_92\MSI]
			   "JAVAUPDATE"="0"
			   "AUTOUPDATECHECK"="0"
           
       É melhor verificar também todas as outras chaves no regedit. Parece que tem um bug no DOS ou no Winrar:  
       paece que a automação do regedit funciona se rodar Primeira_Instalacao_Versao_Windows.bat na mão clicando 2 vezes neste .bat 
       porém não funciona se executado automaticamente pelo Winrar. 
       No teste unitário usando "TestadorUnitarioInstalacaoDesinstalacao.bat" funcionou, porém no teste integrado não funcionou. 
       
       Isso é por causa do seguinte bug : 
       ----------------------------------
       O regedit.exe e o jre-8u92-windows-x64.exe são incompatíveis em relação a : 
	 	HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\JavaSoft\Java Runtime Environment\1.8.0_92\MSI
	      e 
        HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java Runtime Environment\1.8.0_92\MSI

		=> Bug da oracle no instalador do jre.64.exe : 
		   está criando as chaves no lugar errado, no lugar do 32 bit 
		=> O regedit.exe 64 bits automaticamente substitui \SOFTWARE\ por \SOFTWARE\Wow6432Node\       
       
       
       Foi testado que este bug     acontece sim com Windows Server 2008 R2 SP 1.
       Foi testado que este bug não acontece     com Windows Server 2012 R2.
       
       
       
   9d. No caso de versões de Windows que ainda não estão na lista abaixo, 
       fazer testes unitários ou integrais usando os seguintes métodos de teste já prontos, 
       descomentando o seguinte no TestadorUnitário.bat:
			- REM goto InstalarDirLog
			- REM goto DesinstalarDirLog
       * Adicionar nos cabeçalhos destes métodos no TestadorUnitário.bat que isso foi testado com o SO novo.  
       * Adicionar este SO neste item "9d." para não testar mais no futuro. 
       
       A instalação e também a desinstalação já foram testadas nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- Windows Server 2016
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

       
   9e. No caso de versões de Windows que ainda não estão na lista abaixo, 
       fazer testes unitários ou integrais usando os seguintes métodos de teste já prontos, 
       descomentando o seguinte no TestadorUnitário.bat:
			- REM goto InstalarManualTI
			- REM goto DesinstalarManualTI
       * Adicionar nos cabeçalhos destes métodos no TestadorUnitário.bat que isso foi testado com o SO novo.  
       * Adicionar este SO neste item "9e." para não testar mais no futuro. 
       
       A instalação e também a desinstalação já foram testadas nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- Windows Server 2016
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

       
   10. No caso de versões de Windows que ainda não estão na lista abaixo,
       após a instalação, fazer um export de teste das chaves do regedit no servidor
	   e comparar com os arquivos .reg no instalador para verificar se tiver diferenças 
	   em versões diferentes do programa "regedit.exe".

       Já foi testado e comparado nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

	   No caso que tiver alguma diferença no syntax, criar um novo arquivo DeshabilitarJavaUpdates.xxxxxxxxxxx.reg, 
	   e adaptar Primeira_Instalacao_Versao_Windows.bat.
	   Depois disso executar "regedit.exe /s %arquivoRegedit%" em um arquivo .bat separado.
	   
       Em todos os casos, adicionar o novo SO na lista acima.

	   
   11. No caso de versões de Windows que ainda não estão na lista abaixo,
       verificar todas as propriedades da task criada no Task Scheduler:  
       a forma mais fácil é comparar com uma instalação em qualquer Windows Server 2008 R2 SP 1 
       onde a primeir task foi desenvolvida originalmente, ou com outro  SO que já está na lista abaixo. 
       
       Já foi testado e comparado nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

       Se tiver alguma diferença, copiar Integração Portal Cronos - Fornecedor.Windows.2008_R2.TaskSchedule.xml 
       para outro arquivo novo, e adaptar Primeira_Instalacao_Versao_Windows.bat. 
       No outro caso que funcionou, adicionar o novo SO no nome do arquivo e adaptar Primeira_Instalacao_Versao_Windows.bat.
       
       Em todos os casos, adicionar o novo SO na lista acima.


   12. No final, no caso que a versão de Windows ainda não estava homologada,
       descomentar "REM regedit.exe /s %arquivoRegedit%"
	   no arquivo Primeira_Instalacao_Versao_Windows.bat.
      
	   Também descomentar :
		  	) else (
			    echo MSGBOX "Esta versão de Windows ainda não está suportada ! Favor contatar o  Suporte do Portal Cronos." > %temp%\TEMPmessage.vbs
    			call %temp%\TEMPmessage.vbs
			    del %temp%\TEMPmessage.vbs /f /q
			    exit
			)


   13. Só uma vez: 
       No caso de Windows_10_Pro_64bit: testar e remover o seguinte: 
		REM Falta testar o seguinte!!!!!!!!!!!!!!!!!!!!!!!!
		REM Se é para usar %~dp0DeshabilitarJavaUpdates.x64.reg ou DeshabilitarJavaUpdates.x64.reg
		REM no seguinte caso de if %Windows_10_Pro_64bit% == 1:
		REM ) else if %Windows_10_Pro_64bit% == 1 (
		REM     set arquivoRegedit=DeshabilitarJavaUpdates.x64.reg

   
   14. No caso de Windows 10, no Agendador de Tarefas, alterar o dia / hora início para hoje após 5 min.
   
   
   15. No caso de integração com o SAP: 
			There are different distribution packages for various JRE versions and hardware processors available:
			
			    sapjco3-ntintel-3.0.17.zip for a 32-bit JRE running on a 32- or 64-bit AMD or INTEL x86 or a 64-bit INTEL Itanium processor
			    sapjco3-ntia64-3.0.17.zip for a 64-bit JRE running on a 64-bit INTEL Itanium processor
			    sapjco3-ntamd64-3.0.17.zip for a 64-bit JRE running on a 64-bit AMD or INTEL x86 processor 
			
			Note: Before installing JCo, please install the latest Microsoft Visual Studio 2005 C/C++ 
			      runtime libraries as described in note 684106.
			      Obs.: foi testado que tudo funcionou com o Microsoft Visual C/C++ 2010 x64 Redistributable 
			            e  o  Microsoft Visual C/C++ 2013 Redistributable x64 instalados ao mesmo tempo.
			
			To install JCo for Windows unzip the appropriate distribution package into 
			an own arbitrary directory {sapjco3-path}.
			
			Note: Do not copy the sapjco3.dll neither into the {windows-dir}\system32 
			      nor into the {windows-dir}\SysWOW64 directory. 
			      This will break the operability of other JCo versions that are already 
			      installed on the same system. Furthermore you would risk that the 
			      current installation also would not work anymore, if the sapjco3.dll 
			      gets replaced in the respective Windows system directory in the future.
			
			Then add {sapjco3-path} (C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\lib) 
			to the PATH environment variable.
			
			Finally, add {sapjco3-path}\sapjco3.jar to your CLASSPATH environment variable: 
			1. No Eclipse: .............. 
			2. Já foi feito automaticamente pelo pom.xml na geração do .jar. 

   16. (i)  Verificar se "debug" = "true" no arquivo de configuração para facilitar atendimento imediato no futuro, 
            exceto no caso que "SiglaSistema" = "PCronos" (fornecedor "Monitoramento").
       (ii) Verificar se o default de "QtdDiasArquivosXmlGuardados" = "100"
 
   17. Adicionar " and f.id_fornecedor_fornec <> xxx -- NNNNNN ainda não está em produção"
       na procedure [dbo].[monitorarIntegracaoFornecedores]
   
   18. update [dbo].[Usuario_Sistema]  
          set id_fornecedor_fornec = .....
        where cd_usuario_sistema_ususis = 'ericcoringa'
   
       Conectar no Portal Cronos (produção) logado como ericcoringa e verificar se eles usam 
       um texto padrão do fornecedor para todas as cotações de todos os compradores 
       e preencher isso no parâmetro "ObsOfertasPadraoSeNaoTemNoSistema". 
    
   19. Enviar Email/ Skype: 
   
       Vocês têm apenas UMA base de dados WinThor/Oracle? Ou talvez tem uma base de produção e outra base de teste, por exemplo?



       Qual é o endereço IP, porta, SID, usuário e senha do banco Oracle de produção? A porta é a porta "default" (1521) ?
       Pode ser um usuário que tem apenas privilêgio para consulta, pois o Portal Cronos precisa apenas consultar o estoque e os preços dos produtos e alguns dados dos clientes e não faz nenhum salvamento no WinThor.

       Se o DBA demorar demais para criar um usuário novo, não podemos usar um dos usuários Oracle que já existe? Com certeza deve existir pelo menos um. Eu posso até colocar a senha deste usuário no arquivo de parâmetros do Portal Cronos de forma criptografada. 


       Dúvida: na versão atual do Portal Cronos normalmente a senha fica registrada de forma NÃO criptografada no arquivo de configuração no diretório C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\conf\. Pode ser assim? Ou esta senha deve aparecer de forma criptografada neste arquivo?
       
Leão, 
   
  a SOST vai usar um usuário Oracle existente com mais privilêgios do que consulta, 
porém eles preferem que a gente vai registrar a senha no arquivo de configuração de forma criptografada.
Eu posso fazer uma versão nova do serviço de ofertas automáticas com esta funcionalidade nova. 
Previsão: 4 horas no máximo. Vou fazer hoje?
 
Atc,
Eric         
       No caso (falar primeiro com Leão): então vou desenvolver uma versão nova do Portal Cronos, eu faço isso em 4 horas.


Este usuário está dando erro "ORA-00942: a tabela ou view não existe" então este usuário não tem privilégios suficientes.
Sugiro conectar no SQL Navigator ou outra ferramenta com este usuário para ver se este usuário consegue visualizar pelo menos uma tabela ou nenhuma


       
Outra dúvida: os vendedores querem qual das seguintes opções?
1. que o WinThor envia automaticamente os preços ofertados de TODOS os produtos solicitados para o Portal Cronos mesmo no caso que o estoque de alguns produtos estiver zerado no WinThor? 
2. ou apenas os preços dos produtos solicitados que tiverem pelo menos 1 produto no estoque no WinThor?
3. ou apenas os preços dos produtos solicitados que tiverem uma quantidade no estoque no WinThor maior ou igual à quantidade solicitada?            

Exemplos de vantagens / desvantagens:
por exemplo uma possível desvantagem da opção 1: se o cliente escolher a SOST para fornecer alguns produtos e mandar uma ordem de compra, o risco é que vocês não vão conseguir cumprir o pedido ou apenas parcialmente
por exemplo uma possível desvantagem da opção 2 ou 3: no caso que o estoque da SOST não está sendo informado no WinThor, pode acontecer que a SOST vai perder oportunidades de vendas porque a integração automática vai deixar de ofertar produtos       
       

       No caso que os vendedores escolham fora do padrão (2): Todos os vendedores concordam com esta escolha?
        
       ANTIGO: Terminei minha parte da instalação. Favor verificar e salvar as seguintes chaves no arquivo de configuração que já está aberto no servidor atualmente: EnderecoIpServidorBancoDeDados, InstanciaBancoDeDados, UsuarioBancoDeDados, SenhaBancoDeDados, VerificarEstoque, CriterioVerificacaoEstoque, ObsOfertasPadraoSeNaoTemNoSistema, UsarValorMinimoSistemaFornecedor
    

   20. No caso que você precisa atualizar a versão de Java um dia no futuro, 
       no servidor que está hospedando a integração WinThor / PCronos, 
       favor não se esquecer para me avisar com alguns dias de antecedência! 
       Caso contrário, o serviço será interrompido indevidamente alguns dias 
       depois de uma atualização de Java!
       
   21. Verificar, e no caso, enviar o seguinte email: 
   
Leão,
  
   você tem um script pronto para corrigir os caminhos nas base de homologação nova 
[BKP_PCronos_Producao_2018.02.21].[dbo].[Configuracao]?
Pois o servidor da SOST está apontando para o ambiente de homologação e a tabela 
dbo].[Configuracao está apontando para o ambiente de produção. 
Assim o serviço das ofertas da SOST nunca vai poder funcionar pois o site de homologação 
não tem privilêgio para gravar no site de produção então vai dar erro fatal, 
sem nenhum registro de log deste erro... 
 
Eric
   
   22. Na sp dbo.monitorarIntegracaoFornecedores: 
      (i)  adicionar: 
	       		--and f.id_fornecedor_fornec <> xxx -- AAAAAAAAAA
	       depois de: 
	       		--and f.id_fornecedor_fornec <> 385 -- Walmart
   
      (ii) adicionar:
				  or @fornecedor_id = xxx -- AAAAAAAAA ainda não está em produção 
	       depois de: 
				  or @fornecedor_id = 385 -- Walmart ainda não está em produção 

      
   23. Scripts para troubleshooting se não funcionar:
   
declare @fornecedor_id  int
set @fornecedor_id = 

SELECT  *
--delete
  FROM [dbo].[Integracao_Cotacao_Fornecedor]
  where id_fornecedor_fornec = @fornecedor_id

select * 
--delete
  from dbo.Log_Erro_Integracao
  where id_fornecedor_fornec = @fornecedor_id
  --and ds_ocorrencia_logeint like 'Já%'
   
   
         
Manual para a geração do instalador Setup.exe:
==============================================

1. No Windows Explorer (não no Eclipse) navegar na máquina de desenvolvimento para o diretório 
   C:\PCronos\Integração Fornecedor - Portal Cronos\Instalador\Windows\Arquivos de Programas PC\
   e ordenar os arquivos por nome alfabético.
    
2. Deletar ou renomear o arquivo "Instalador do Integrador Fornecedores - Portal Cronos.2.4.1.Win2008.R2.SP1.exe".
     
3. Usando o Winrar 4.01, criar um self extractable file com absolute path "C:/" 
   que cria /"Arquivos de Programas PC"/* no servidor do fornecedor, da seguinte forma :
      - Selecionar todos os arquivos porém apenas um (1) dos subdiretórios no raiz do diretório navegado no Windows Explorer:
            - selecionar apenas UM dos dois arquivos jre-8u92-windows-i586.exe ou jre-8u92-windows-x64.exe
            - selecionar apenas UM dos dois arquivos DeshabilitarJavaUpdates.i586.reg ou DeshabilitarJavaUpdates.x64.reg
            - selecionar o subdiretório \Integração Fornecedor - Portal Cronos\ com conteúdo completa.
            - NÃO selecionar    Instalador*.exe                   
      - WinRAR                   : Mudar .rar para .zip
      - WinRAR                   : Método de compressão : Ótimo
      - WinRAR                   : marcar checkbox SFX
      - Nome                     : Instalador do Integrador Fornecedores - Portal Cronos.2.4.1.Win2008.R2.SP1.exe
                                   Obs.: Se mudar para outro nome diferente de "Instalador do Integrador Fornecedores - Portal Cronos.*.exe", 
                                         ajustar o mesmo no final de Primeira_Instalacao_Versao_Windows.bat.

   Aba "Avancado" do WinRAR > botão "Opções SFX..." : 
      - Sub-aba "Geral"          : Apenas na primeira vez em uma máquina de desenvolvimento nova 
                                   ou em outra máquina diferente: clicar botão "Salvar configurações SFX" 
                                   e fazer as configurações abaixo: 
                                       (na segunda vez tudo já está salvo, apenas precisa abrir 
                                        a aba "Avancado" > botão "Opções SFX..." e clicar OK, 
                                        e não precisa fazer o resto abaixo.)
      - Caminho para extração    : C:\Arquivos de Programas PC (sem double quotes, e sem barra no final)
      - Marcar                   : Absolute path
      - Marcar ou deixar marcado : Checkbox "Salvar e restaurar caminho"
      - Executar após a extração : Primeira_Instalacao_Versao_Windows.bat 
                                   (pelo menos o Winrar 4.01 tem este After Extraction Trigger)
      - Sub-aba "Avançado"       : Marcar checkbox "Pedido de acesso administrativo"
      - Sub-aba "Métodos"        : Selecionar "Modo silencioso" > "Ocultar tudo"     
      - Sub-aba "Atualizar"      : Marcar "substituir todos os arquivos"


IMPORTANTE !!!!!!!!
===================
Ao alterar o arquivo .bat do job, editar com o editor de DOS 
e não com o Notepad para evitar problemas com cedilhas e acentos !
 

 
