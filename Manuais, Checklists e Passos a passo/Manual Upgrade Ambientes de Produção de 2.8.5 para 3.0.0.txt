Manual Upgrade dos Ambientes de Produção de 2.8.5 para 3.0.0 
============================================================


A. Upgrade de forma automatizada:
=================================

1. Gerar o Instalador no Eclipse e copiar para o servidor do fornecedor.
 
2. Backup do(s) arquivo(s) de configuração.
 
3. Esperar até o processo atual do Integrador terminou.
 
4. (i)   Primeiro verificar que o desinstalador não desinstala java!!!
         No caso, descomentar "goto SKIP_JRE"
   (ii)  Desinstalar tudo   
   (iii) Verificar se apagou menu de Windows, Task Schedule, Diretórios

5. Re-instalar Marizpan: 
	- Adicionar cliente novo "Marizpan"
	- Copiar o conteúdo do backup do config da Marizpan para "Integração APS - Portal Cronos.Marizpan.properties"

	- Alterar os ícones no menu de Windows manualmente: 
			- Ícone ....../res/AdicionarInstancia.ico
			- Ícone ....../res/RemoverInstancia.ico
			- Ícone ....../res/ConfiguraçõesInstância.ico

	- Alterar o dir C:\Arquivos de Programas PC\ para Hidden e System File, executando o seguinte 
	  na tela preta de DOS: ??????????????????automatizada não????????????????
	    	cd\
	    	attrib "Arquivos de Programas PC" +S +H	    
	  (é necessário para evitar cópias hackeadas e erradas dos arquivos de configuração, 
	   sem ter criado um Windows Task Schedule) 
	- 
		  (i)  No Windows Explorer alterar a opção para NÃO exibir arquivos de sistema operacional protegidos, 
		       (marcar "Hide protected operating system files")  
		       porém pode exibir hidden files, para todos os usuários inclusive cronostech 
		       (marcar "Show hidden files, folders, and drives")
		  (ii) Verificar se o diretório "Arquivos de Programas PC" ficou invisível no Windows Explorer como deveria

6. Adicionar instância nova "Atacamax"
		- Alterar o ícone do Atacamax no menu de Windows manualmente: 
			- Ícone ....../res/ConfiguraçõesInstância.ico

7. Em todos os casos de servidores de PRODUÇÃO (não no servidor de Homologação do APS Cloud): 
     - Verificar a memória RAM livre no servidor do fornecedor (sem contar meu JVM).
		    - Preencher isso no f[i].MemoriaRamLivre = "" no FornecedorRepositorio   
	 - Observação: no servidor de monitoramento o serviço + JVM ocupa 60 MB de memória
	 

8. Em todos os casos: 
     - Acompanhar 15 minutos se o Integrador começa executar automaticamente
     
9. (i)   Atualizar a versão do .jar no arquivo "FornecedorRepositorio.java" para o fornecedor que foi atualizado
   (ii)  Compilar o arquivo .jar
   (iii) Atualizar o arquivo .jar no servidor de monitoramento (não precisa atualizar o servidor do fornecedor)
         esperando o processamento atual terminar primeiro
   


B. Upgrade de forma manual:
========--------===========

1. Apenas no caso do servidor do monitoramento:
	 - Conectar como cronostech
     - No Windows Explorer alterar a opção para exibir arquivos de sistema 
       (desmarcar "Hide protected operating system files") temporariamente


2. Fazer exatamente na seguinte sequência:
   (i)   Em todos os casos exceto JR Distribuição / Windows 10:
         Verificar se o arquivo .bat e o .jar atual estão em uso: 
         verificar o horário da última e da próxima execução no Task Scheduler 
         e verificar no taskmgr.exe se o JRE está rodando ainda. 
         Esperar até o JRE terminou.
   
   (ii)  Em todos os casos (incluindo no caso JR Distribuição / Windows 10):
 		   - Adicionar "exit" seguida por uma linha em branco no início do arquivo 
 		     Job15a15minOfertamentoJava_Windows.bat no servidor do fornecedor. 
 		     (NÃO renomear Job15a15minOfertamentoJava_Windows.bat para evitar que o Scheduler 
              possivelmente se perde comprometendo os derrubamentos automáticos dos JRE´s travados)

   (iii) Apenas no caso de instalação no servidor da JR Distribuição (Windows 10):
	        a. Primeiro verificar no diretório C:\ProgramData\PortalCronos\Logs\Local\ 
	           se o Integrador está ofertando no momento e ficar esperando até ele terminar 
	           o último passo (a atualização do arquivo TemposExecução.log)
 
		    b. Matar o processo JRE 1.8.0_92
		 		 
		   
3. (i)  Copiar o arquivo novo integr-fornecedor-3.0.0.jar do instalador para o servidor do fornecedor.
   (ii) Apagar a versão anterior integr-fornecedor-*.*.*.jar.
 
4. Em todos os casos:
   (i) Atualizar os seguintes arquivos no servidor do fornecedor:
		- /bin/Versao.bat 
		- /bin/CaminhoJRE.bat
		- /bin/IsAmbienteNuvem.bat
		- /bin/ComponenteTestador.bat
		- /bin/VerificarUsuarioAdministrador.bat
		- Job15a15minOfertamentoJava_Windows.bat 
			- Re-adicionar "exit" seguida por uma linha em branco no início do arquivo 
		- Desinstalar_Integração_Fornecedor_PortalCronos.bat
		- TestadorUnitario.bat
				
   (ii) Gravar 0 ou 1 no arquivo /bin/IsAmbienteNuvem.bat + linebreak depois do 0 / 1	
 
5. Apenas no caso do APS Cloud: 
	- Copiar do projeto Eclipse para o servidor do APS Cloud:
		- AdicionarFornecedorNuvem.bat
		- RemoverFornecedorNuvem.bat
		- conf/TemplateNuvemAPS.properties
		- res/*.ico
	- Apagar o Task Schedule atual
	- Backup do arquivo config .properties da Marizpan
	- Apagar o arquivo "conf/Integração Fornecedor - Portal Cronos.properties"
	- No menu de Windows "Iniciar" > "Portal Cronos" remover o atalho "Manual Manutenção TI" por enquanto
	- No menu de Windows "Iniciar" > "Portal Cronos" adicionar o subdir novo "Integrador APS Cloud/WinThor Cloud/..."
	- No menu de Windows "Iniciar" > "Portal Cronos" > "Integrador APS Cloud":
		- Criar o seguinte atalho:
			- "C:\Arquivos de Programas PC\AdicionarFornecedorNuvem.bat"
			- Renomear para "Adicionar Instância"
			- Ícone ....../res/AdicionarInstancia.ico
		- Criar o seguinte atalho:
			- "C:\Arquivos de Programas PC\RemoverFornecedorNuvem.bat"
			- Renomear para "Remover Instância"
			- Ícone ....../res/RemoverInstancia.ico
	- Adicionar cliente novo "Marizpan"
	- Copiar o conteúdo do backup do config da Marizpan para "Integração APS - Portal Cronos.Marizpan.properties"
	- No menu de Windows "Iniciar" > "Portal Cronos" > "Integrador APS Cloud":
		- Verificar se o seguinte atalho foi criado pela tela "Adicionar Instância":
			- "C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\conf\Integração APS - Portal Cronos.Marizpan.properties"
			- Atalho renomeado para "Configurações Marizpan"
			- Ícone alterado para ....../res/ConfiguraçõesInstância.ico
		- Caso contrário, fazer isso na mão
	- Alterar o dir C:\Arquivos de Programas PC\ para Hidden e System File, executando o seguinte 
	  na tela preta de DOS: 
	    	cd\
	    	attrib "Arquivos de Programas PC" +S +H	    
	  (é necessário para evitar cópias hackeadas e erradas dos arquivos de configuração, 
	   sem ter criado um Windows Task Schedule) 
	- 
		  (i)  No Windows Explorer alterar a opção para NÃO exibir arquivos de sistema operacional protegidos, 
		       (marcar "Hide protected operating system files")  
		       porém pode exibir hidden files, para todos os usuários inclusive cronostech 
		       (marcar "Show hidden files, folders, and drives")
		  (ii) Verificar se o diretório "Arquivos de Programas PC" ficou invisível no Windows Explorer como deveria
	- Adicionar instância nova "Atacamax"
	- No menu de Windows "Iniciar" > "Portal Cronos" > "Integrador APS Cloud":
		- Verificar se o seguinte atalho foi criado pela tela "Adicionar Instância":
			- "C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\conf\Integração APS - Portal Cronos.Atacamax.properties"
			- Atalho renomeado para "Configurações Atacamax"
			- Ícone alterado para ....../res/ConfiguraçõesInstância.ico
		- Caso contrário, fazer isso na mão


6. Em todos os casos de servidores de PRODUÇÃO (não no servidor de Homologação do APS Cloud): 
     - Verificar a memória RAM livre no servidor do fornecedor (sem contar meu JVM).
		    - Preencher isso no f[i].MemoriaRamLivre = "" no FornecedorRepositorio   
	 - Observação: no servidor de monitoramento o serviço + JVM ocupa 60 MB de memória
	 
 
7. Remover "exit" e a linha em branco no início do arquivo Job15a15minOfertamentoJava_Windows.bat
   no servidor do fornecedor (Sempre como último passo no AnyDesk para forçar 100 % conclusão do upgrade).

8. Em todos os casos: 
     - Acompanhar 15 minutos se o Integrador começa executar automaticamente
     
9. Apenas no caso do servidor do monitoramento: 
     (i)  No Windows Explorer voltar a opção para não exibir arquivos de sistema 
          (marcar "Hide protected operating system files")
     (ii) Fechar o Windows Explorer e abrir novamente
     
     
10. (i)   Atualizar a versão do .jar no arquivo "FornecedorRepositorio.java" para o fornecedor que foi atualizado
    (ii)  Compilar o arquivo .jar
    (iii) Atualizar o arquivo .jar no servidor de monitoramento (não precisa atualizar o servidor do fornecedor)
          esperando o processamento atual terminar primeiro
   
