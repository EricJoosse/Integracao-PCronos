Checklist instalação em um fornecedor novo 
==========================================
 

IMPORTANTE !!!!!!!!
===================
Ao alterar o arquivo .bat do job, ou outros arquivos .bat, editar com o editor de DOS 
e não com o Notepad para evitar problemas com cedilhas e acentos !
 
 
   -5. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
       criar um registro novo no arquivo Tabela Fornecedores_Versões.txt para o fornecedor novo.
       Descobrir o idFornecedor editando e executando os seguintes selects:

select id_fornecedor_fornec, id_pessoa
  from dbo.Fornecedor 
 where id_pessoa in (select  id_pessoa
                      from  dbo.Pessoa
                     where  nm_pessoa like '%Padeirão%')

select  id_pessoa, nm_pessoa, *
                      from  dbo.Pessoa
                     where  nm_pessoa like '%Padeirão%'


   -4. (i) Se ainda não saber o contato no Skype, editar e enviar o seguinte email:

Elthon, boa tarde!
 
    sou da TI do Portal Cronos. Vou instalar a integração WinThor / PCronos hoje.
Qual é o nome do seu contato no Skype?
 
Atc,
Eric

	(ii) Se já sabe o contato no Skype, editar e enviar o seguinte email:
     
Tiago, boa tarde!
 
  sou Eric da TI do Portal Cronos.  Leão me pediu instalar o Integrador WinThor / PCronos.
Favor me aceitar no Skype (contato "Eric Jo") e ativar o AnyDesk e informar o ID no Skype,
 
Atc,
Eric 

   (iii) No caso de re-instalação:
   
Marcos, bom dia!   
     
Favor ativar o AnyDesk e informar o ID no Skype. Pretendo re-instalar o Integrador WinThor / PCronos hoje, 
 
Atc,
Eric 
     
     
   -3. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
       no FornecedorRepositorio.java, método getFornecedor(), adicionar o fornecedor novo. 
    
   -2. Leão, 
   
	   	VerificarEstoque                  = true / false?
		CriterioVerificacaoEstoque        = QtdEstoqueMaiorZero / QtdEstoqueMaiorOuIgualQtdSolicitada?
		ObsOfertasPadraoSeNaoTemNoSistema = ?
		UsarValorMinimoSistemaFornecedor  = true / false?
		 
	   Eric
   

   -1. NÃO colocar os dados do fornecedor novo no arquivo único /conf/.properties no diretório da instalação 
       C:\PCronos\Integração Fornecedor - Portal Cronos\Instalador\Windows\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\conf\.
       
       Porém colocar os dados do fornecedor novo no arquivo no diretório de backup neste projeto Eclipse:
         diretório: C:\PCronos\Integração Fornecedor - Portal Cronos\conf\
         arquivo  : Integração Fornecedor - Portal Cronos.x.y.z.properties.WinThor(APS).NomeFornecedor.Homolog
       
       Não comittar este arquivo no GitHub pois contêm senhas!!! Adcionar no .gitignore.  
       
            
       Neste momento apenas preencher os seguintes dados (os outros dados estão explicados no final da instalação): 
       (i)   Descobrir o CNPJ do fornecedor usando o mesmo select acima.
       
       (ii)  No caso do WinThor, "pfv me dá a lista de filiais que têm no WinThor" 
             para decidir se a filial do estoque é 1, 2, ou 3. 
             Não podemos usar o estoque de uma loja de balçao pequena.   
       
       (iii) No caso de instalação do serviço de monitoramento automático no servidor de aplicação do Portal Cronos 
       		 apenas preencher as seguintes chaves e deixar o resto como o default do instalador: 
       			- SiglaSistema: PCronos
       			- Todas as chaves da seção "Base de Dados do sistema do fornecedor"
       			- Todas as chaves "******EmailAutomatico"

       (iv)  Verificar se "debug" = "true" no arquivo de configuração para facilitar atendimento imediato no futuro, 
             exceto no caso que "SiglaSistema" = "PCronos" (fornecedor "Monitoramento").

       (v)   Verificar se o default de "QtdDiasArquivosXmlGuardados" = "100" para servidores dos fornecedores
             e "30" para o servidor de monitoramento automático


    0. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
       no FornecedorRepositorio.java, no OUTRO método getIdFornecedorByCnpj(), 
       adicionar o fornecedor novo também. 


	1. Conectar no AnyDesk. 
	   Obs.: na máquina na Apply:                     o Team Viewer dá mensagem de suspeita de uso comercial; 
	         na máquina no Cabo:                      verificar;
	         na máquina de desenvolvimento no Azure:  o Team Viewer dá mensagem de suspeita de uso comercial;
	         na máquina de desenvolvimento no Amazon: verificar;
	         no servidor de teste:                    verificar.
	
	   Skype:
	   Bom dia, sou Eric da TI do Portal Cronos. Leão me pediu instalar o Integrador WinThor / PCronos. Tem o AnyDesk instalado?
	   
	   
	   Skype:
       Nossa licença do Team Viewer expirou. O AnyDesk é gratuito e é ainda mais fácil do que o Team Viewer. Pode ser?

	   Skype:
	   Existem 2 tipos de instalação do Team Viewer: "free" (pessoal) e "trial"/pago (empresarial). 
Meu Team Viewer é "free" e pessoal então não consigo conectar com seu Team Viewer empresarial. 
Você quer desinstalar sua versão "trial" (ou pago?) e instalar a versão "free" do Team Viewer? 
Caso contrário, sugiro instalar o AnyDesk, que é sempre de graça. 
Como última opção vou falar com Leão para ele pagar a licença do Team Viewer empresarial. 
Como vai ser?

	
		Skype:
		Quando você desocupar o servidor, me avise


	2. a. Verificar se o usuário logado é administrador ou administrator, 
	      local ou da rede (como administrador da rede ainda não foi testado).
	      (Formaggio: user "techcorp")
	      
	   b. Verificar se o usuário logado consegue abrir o botão "Environment Variables" 
	      no Control Panel > System > Advanced System Settings > "Environment Variables".
	      Caso contrário, provavelmente o usuário logado é de uma máquina virtual. 
	      Pedir a TI conectar com um usuário administrador na máquina real debaixo da máquina virtual.
	      
	   c. Nas opções do Windows Explorer marcar "Mostrar arquivos, pastas e unidades ocultas"  
	      (foi testado no fornecedor Padeirão que não precisa desmarcar "Hide protected operating system files").
	      Fechar e re-abrir o Windows Explorer. Senão re-abrir o Windows Explorer, 
	      vai pensar indevidamente que não existe o dir C:\ProgramData\ por exemplo............. 
	
	3. No arquivo "Primeira_Instalacao_Versao_Windows.bat" : 
		- Verificar a versão de Windows no servidor do fornecedor 
		  e descomentar a variável "osVersion" correta no início do .bat. 
		  CMD: winver
		  ou:  systeminfo | findstr OS
		  
		- Verificar a variável "tipoOS=32" ou "tipoOS=64" no .bat
		
		- Se a versão de Windows ainda não está homologada, 
		  comentar "regedit.exe /s %arquivoRegedit%" no  "if %tipoOS% == 64" ou "32".		  
		  CUIDADO PARA NÃO CORROMPER O REGEDIT !!!!!!!!!
		  CUIDADO PARA NÃO CORROMPER O REGEDIT !!!!!!!!!
		  CUIDADO PARA NÃO CORROMPER O REGEDIT !!!!!!!!!
		  
		  Também comentar :
		  	) 
		  	REM else (
			REM     echo MSGBOX "Esta versão de Windows ainda não está suportada ! Favor entrar em contato com o Suporte do Portal Cronos." > %temp%\TEMPmessage.vbs
    		REM 	call %temp%\TEMPmessage.vbs
			REM     del %temp%\TEMPmessage.vbs /f /q
			REM     exit
			REM )
			
		  Observação ; depois de "REM" deve ter pelo menos UM espaço em branco !!!!!

		- Verificar a variável "set drive=C:"  ou "set drive=D:" no início de Primeira_Instalacao_Versao_Windows.bat 
		  Verificar se tem espaço livre de 1 GB nos discos C:/, D:/, etc. :
			- 303 MB: 
				- C:\Arquivos de Programas PC\*
				- C:\Program Files\Java\jre1.8.0_92\*
				- C:\temp\Instalar Integração Fornecedores - Portal Cronos.exe
			- 250 MB: 
			    - C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\hs_err_pidxxxx.mdmp
			- 450 MB: (Prolac: 30 MB por mês)
				- C:\ProgramData\PortalCronos\Logs\Local\*.xml  (estimativa inicial do tamanho de 1 ano de arquivos de XML)
				- C:\ProgramData\PortalCronos\Logs\Local\*.log  (estimativa inicial do tamanho de 1 ano de arquivos de XML)

		  
		- Verificar se precisa descomentar um dos seguintes skips no início de Primeira_Instalacao_Versao_Windows.bat :
						REM goto SKIP_JRE
						REM goto SKIP_JRE_TEMPDIR
						REM goto SKIP_JRE_TEMPDIR_PROGRAMDIR
						REM goto SKIP_JRE_TEMPDIR_PROGRAMDIR_TASK
		  e verificar eventuais outros goto´s 
 
 
    4. Antes da instalação:       					       
          0. Primeiro fazer backup (no arquivo "Backup variáveis de ambiente do sistema Path de Windows.txt"):
                (i)  do variável de ambiente do sistema "Path" de Windows: 
                (ii) do diretório  C:\ProgramData\Oracle\Java\javapath\
                
             e verificar:
              
          1. Verificar se já tem outra instalação de Java nos diretórios:
          			- C:\Program Files\
          			- C:\Program Files (x86)\
          			- C:\Arquivos de Programas\
          			- C:\Arquivos de Programas (x86)\
          			- C:\pcsist\programas\
          			
             No caso que tem muitas outras versões do JRE mais antigas e mais novas instaladas:  
             Skype: No servidor onde estou estou vendo 2 versões diferentes de Java instaladas (1.8- 101 e 1.8 - 111). 
             		Java está usado por que programas no servidor?
             
             No caso: 
             Skype: Vou tomar cuidado para deixar as versões atuais do mesmo jeito como está para evitar que algum sistema 
             ou aplicativo para de funcionar. 
             
             No caso: 
             Descomentar "REM goto SKIP_JRE"no arquivo "Primeira_Instalacao_Versao_Windows.bat"              
             (feito assim no Padeirão e na Prolac)
                
	    	 No caso se decidir não instalar uma JRE nova porém usar uma JRE existente já instalado no servidor:
	     		- primeiro fazer um teste rápido se o seguinte funciona: 
					C:/"Program Files (xxxxxxxxxxxx)"/Java/jre1.8.0_xxxxx/bin/java.exe -version
					
             	  caso contrário, não adianta instalar o Integrador usando o JRE existente: 
	     			- verificar se tem processos Java funcionando no taskmgr.exe
	     			- decidir: 
						- Skype: quem instalou Java? 
	        			- ou talvez instalar Java nova em paralelo????

             
       	  2. se já tinha C:\ProgramData\Oracle\Java\javapath\ na primeira posição no PATH antes da minha instalação
       	       (i)   no variável de ambiente do usuário administrador
       	       (ii)  no variável de ambiente do sistema
     	  3. se tem outro caminho de java no PATH e se java.exe se encontra em um dos caminhos do PATH, 
     	     por exemplo em C:\WINDOWS\System\
       	       (i)   no variável de ambiente do usuário administrador
       	       (ii)  no variável de ambiente do sistema
     	  4. No caso que já tinha um C:\ProgramData\Oracle\Java\javapath\ no servidor, fazer backup dos atalhos atuais 
     	     antes da instalação.
       	       (i)   do variável de ambiente do usuário administrador
       	       (ii)  do variável de ambiente do sistema

       No caso que no servidor do fornecedor já tem outra versão mais antiga do JRE instalada na mesma maquina, 
       depois da instalação remover C:\ProgramData\Oracle\Java\javapath\ na primeira posição no PATH, se não tinha antes. 
       Isso é para evitar que programas de terceiros param de funcionar corretamente.

       No caso que no servidor do fornecedor já tinha outra versão mais nova do JRE instalada na mesma maquina, 
       após a instalação voltar os atalhos em C:\ProgramData\Oracle\Java\javapath\ para como estava antes.


    5a. Descobrir o endereço IP público do servidor do fornecedor e uma porta IP que está aberta 
        para poder fazer ping ou TNSping de fora para o servidor do fornecedor na hora que precisar. 
        No IE, Chrome ou Firefox acessar http://ip4.me/
        Testar ping primeiro (sem porta). Se isso não funcionar, procurar uma porta IP que está aberta e usar 
        C:\PCronos\Integração Fornecedor - Portal Cronos\PsPing_Servidor_Fornecedor.bat para testar isso. 
        
        Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
        atualizar o endereço IP e a porta IP aberta no arquivo Tabela Fornecedores_Versões.txt.
                
    5b. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
        preencher todas as outras colunas no arquivo Tabela Fornecedores_Versões.txt.
    
    5c. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
        no FornecedorRepositorio.java, método getFornecedor(), preencher o resto de TODOS 
        os outros campos do fornecedor sem falta, antes de continuar, pois sem isso a instalação do 
        Manual de Manutenção para a TI não vai funcionar corretamente.
        
        Se ainda não saber o endereço de email da TI, copiar o seguinte para o Skype:
        Qual é seu endereço de email. É necessário para receber avisos automáticos um dia no futuro 
        quando o servidor ficará desligado ou travado, ou o disco estiver cheio, 
        ou no caso de todas as outras causas de paradas da integração automática.
        
        
    5d. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
        executar Maven para compilar e atualizar integr-fornecedor-x.y.z.jar 
        (no diretório ...\Instalador\Windows\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\)
          
    6. Provisoriamente (enquanto que ainda não existe uma tabela nova dbo.Fornecedor_Integrado): 
       NUNCA MAIS PULAR ESTE PASSO (por causa da geração do Manual de Manutenção para a TI): 
       Regerar o instalador, veja o arquivo "Passo a passo geração ou re-geração do instalador Setup.exe.txt"  
       no diretório C:\PCronos\Integração Fornecedor - Portal Cronos\Manuais, Checklists e Passos a passo\.
    
    7. O instalador deve ser copiado para exatamente o diretório C:\temp\ no servidor do fornecedor.
       Se for outro diretório, ajustar este diretório no final de Primeira_Instalacao_Versao_Windows.bat.
    
       Se dar erro "Access denied", a solução que funcionou no Padeirão é para criar um diretório novo C:\xxx_temp\ 
       e depois copiar de lá para C:\temp\. Apagar C:\xxx_temp\ depois disso.
       
       Skype (se precisar ainda):
       Não estou conseguindo copiar arquivos para o diretório C:\Temp\ devido ao erro "Access denied"
       
    
    8. Durante a instalação: 
            - Mouse sobre o instalador, botão direito do mouse "Executar como Administrador"
            
            - No caso de instalação do serviço de monitoramento automático no servidor de aplicação do Portal Cronos: 
              na pergunta do idFornecedor preencher -1. 

 
    9.  Após a instalação:
    
    9a. Apagar Instalador.log e .gitignore no servidor do fornecedor
    
    9a. No caso: no arquivo Primeira_Instalacao_Versao_Windows.bat re-comentar REM goto SKIP_JRE 

    9a. Verificar e comparar o variável de ambiente do sistema "Path" de Windows
    
    9b. Restaurar o backup de C:\ProgramData\Oracle\Java\javapath\, no caso.
          
    9c. No caso que este instalador não instalou o JRE:
        no regedit.exe deshabilitar java update automático de todos os jre´s em todas as 
        chaves que existem no regedit 

    9d. No caso que este instalador instalou o JRE: 
        Nos seguintes casos:
             1. no caso de versões de Windows que ainda não estão em nenhuma das duas listas abaixo dentro deste item 9c;
             2. no caso de versões de Windows que estão com o bug abaixo: 
             
        Corrigir as seguintes chaves manualmente no regedit :
          [HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java Runtime Environment\1.8.0_92\MSI]
			   "JAVAUPDATE"="0"
			   "AUTOUPDATECHECK"="0"
           
       É melhor verificar também todas as outras chaves no regedit. Parece que tem um bug no DOS ou no Winrar:  
       foi testado com Windows Server 2012 R2 e com Windows Server 2016 que a automação do regedit funciona 
       se rodar "Primeira_Instalacao_Versao_Windows.bat" na mão clicando 2 vezes neste .bat ou usando o botão a direita 
       usando "Executar como Administrador", 
       porém não funciona se "Primeira_Instalacao_Versao_Windows.bat" for executado automaticamente pelo Winrar. 
       No teste unitário usando "TestadorUnitarioInstalacaoDesinstalacao.bat" também funcionou, porém no teste integrado não funcionou. 
       
       Isso é por causa do seguinte bug : 
       ----------------------------------
       O regedit.exe e o jre-8u92-windows-x64.exe são incompatíveis em relação a : 
	 	HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\JavaSoft\Java Runtime Environment\1.8.0_92\MSI
	      e 
        HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java Runtime Environment\1.8.0_92\MSI

		=> Bug da oracle no instalador do jre.64.exe : 
		   está criando as chaves no lugar errado, no lugar do 32 bit 
		=> O regedit.exe 64 bits automaticamente substitui \SOFTWARE\ por \SOFTWARE\Wow6432Node\       
       
       
       Foi testado que este bug     acontece sim com Windows Server 2008 R2 SP 1.
       Foi testado que este bug não acontece     com Windows Server 2012 R2 usando o Testador Unitário, porém acontece sim no teste integrado....
       Foi testado que este bug não acontece     com Windows Server 2016    usando o Testador Unitário, porém acontece sim no teste integrado....
       
       
       
   9e. No caso de versões de Windows que ainda não estão na lista abaixo dentro deste item 9d, 
       fazer testes unitários ou integrais usando os seguintes métodos de teste já prontos, 
       descomentando o seguinte no TestadorUnitário.bat:
			- REM goto InstalarDirLog
			- REM goto DesinstalarDirLog
       * Adicionar nos cabeçalhos destes métodos no TestadorUnitário.bat que isso foi testado com o SO novo.  
       * Adicionar este SO neste item "9d." para não testar mais no futuro. 
       
       A instalação e também a desinstalação já foram testadas nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- Windows Server 2016
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

       
   9f. No caso de versões de Windows que ainda não estão na lista abaixo dentro deste item 9e, 
       fazer testes unitários ou integrais usando os seguintes métodos de teste já prontos, 
       descomentando o seguinte no TestadorUnitário.bat:
			- REM goto InstalarManualTI
			- REM goto DesinstalarManualTI
       * Adicionar nos cabeçalhos destes métodos no TestadorUnitário.bat que isso foi testado com o SO novo.  
       * Adicionar este SO neste item "9e." para não testar mais no futuro. 
       
       A instalação e também a desinstalação já foram testadas nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- Windows Server 2016
       		- Windows 10 Pro - apenas testado no caso de um processador e SO 64 bit
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 
       
       Obs.: se a instalação do manual no menu de Windows não funcionou usando o instalador integral, 
             fazer isso executando InstalarManualTI.bat solto com o botão a direita do mouse usando 
             "Executar como Administrador". 

       
   9g. No caso que foi copiado para outro diretório, apagar o instalador manualmente após a instalação!
       No caso do Comal:  copiado para a Área de Trabalho do usuário FusionDMC.
       No caso do Propão: copiado para C:\eric_temp\ e outra cópia parcial para a Área de Trabalho do usuário Administrador.


   10. No caso de versões de Windows que ainda não estão na lista abaixo dentro deste item 10,
       após a instalação, fazer um export de teste das chaves do regedit no servidor
	   e comparar com os arquivos .reg no instalador para verificar se tiver diferenças 
	   em versões diferentes do programa "regedit.exe".

       Já foi testado e comparado nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- Windows Server 2016
       		- Windows 10 Pro - apenas testado e comparado no caso de um processador e SO 64 bit
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

	   No caso que tiver alguma diferença no syntax, criar um novo arquivo DeshabilitarJavaUpdates.xxxxxxxxxxx.reg, 
	   e adaptar Primeira_Instalacao_Versao_Windows.bat.
	   Depois disso executar "regedit.exe /s %arquivoRegedit%" em um arquivo .bat separado.
	   
       Em todos os casos, adicionar o novo SO na lista acima.

	   
   11. No caso de versões de Windows que ainda não estão na lista abaixo dentro deste item 11,
       verificar todas as propriedades da task criada no Task Scheduler:  
       a forma mais fácil é comparar todas as propriedades da task com uma instalação em um Windows Server 2008 R2 SP 1 
       onde a primeir task foi desenvolvida originalmente, ou que foi testado que funciona, 
       ou com outro SO que já está na lista abaixo e que foi testado. 
       
       Já foi testado e comparado nos seguintes SO´s:
       		- Windows Server 2008 R2 SP 1
       		- Windows Server 2012 R2
       		- Windows Server 2016
       		- ......
       Fazer isso ainda em todos os outros tipos de Windows. 

       Se tiver alguma diferença, copiar Integração Portal Cronos - Fornecedor.Windows.2008_R2.TaskSchedule.xml 
       para outro arquivo novo, e adaptar Primeira_Instalacao_Versao_Windows.bat. 
       No outro caso que funcionou, adicionar o novo SO no nome do arquivo e adaptar Primeira_Instalacao_Versao_Windows.bat.
       
       Em todos os casos, adicionar o novo SO na lista acima.


   12. No final, no caso que a versão de Windows ainda não estava homologada,
       descomentar "REM regedit.exe /s %arquivoRegedit%"
	   no arquivo Primeira_Instalacao_Versao_Windows.bat.
      
	   Também descomentar :
		  	) else (
			    echo MSGBOX "Esta versão de Windows ainda não está suportada ! Favor contatar o  Suporte do Portal Cronos." > %temp%\TEMPmessage.vbs
    			call %temp%\TEMPmessage.vbs
			    del %temp%\TEMPmessage.vbs /f /q
			    exit
			)


   13. Só uma vez: 
       No caso de Windows_10_Pro_64bit: testar e remover o seguinte: 
		REM Falta testar o seguinte!!!!!!!!!!!!!!!!!!!!!!!!
		REM Se é para usar %~dp0DeshabilitarJavaUpdates.x64.reg ou DeshabilitarJavaUpdates.x64.reg
		REM no seguinte caso de if %Windows_10_Pro_64bit% == 1:
		REM ) else if %Windows_10_Pro_64bit% == 1 (
		REM     set arquivoRegedit=DeshabilitarJavaUpdates.x64.reg

   
   14. No caso de Windows 10, no Agendador de Tarefas, alterar o dia / hora início para hoje após 5 min.
   
   
   15. No caso de integração com o SAP: 
			There are different distribution packages for various JRE versions and hardware processors available:
			
			    sapjco3-ntintel-3.0.17.zip for a 32-bit JRE running on a 32- or 64-bit AMD or INTEL x86 or a 64-bit INTEL Itanium processor
			    sapjco3-ntia64-3.0.17.zip for a 64-bit JRE running on a 64-bit INTEL Itanium processor
			    sapjco3-ntamd64-3.0.17.zip for a 64-bit JRE running on a 64-bit AMD or INTEL x86 processor 
			
			Note: Before installing JCo, please install the latest Microsoft Visual Studio 2005 C/C++ 
			      runtime libraries as described in note 684106.
			      Obs.: foi testado que tudo funcionou com o Microsoft Visual C/C++ 2010 x64 Redistributable 
			            e  o  Microsoft Visual C/C++ 2013 Redistributable x64 instalados ao mesmo tempo.
			
			To install JCo for Windows unzip the appropriate distribution package into 
			an own arbitrary directory {sapjco3-path}.
			
			Note: Do not copy the sapjco3.dll neither into the {windows-dir}\system32 
			      nor into the {windows-dir}\SysWOW64 directory. 
			      This will break the operability of other JCo versions that are already 
			      installed on the same system. Furthermore you would risk that the 
			      current installation also would not work anymore, if the sapjco3.dll 
			      gets replaced in the respective Windows system directory in the future.
			
			Then add {sapjco3-path} (C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\lib) 
			to the PATH environment variable.
			
			Finally, add {sapjco3-path}\sapjco3.jar to your CLASSPATH environment variable: 
			1. No Eclipse: .............. 
			2. Já foi feito automaticamente pelo pom.xml na geração do .jar. 


   16. Apenas no caso de instalação no servidor do monitoramento:
		  (i)  No Windows Explorer alterar a opção para NÃO exibir arquivos de sistema operacional protegidos, 
		       (marcar "Hide protected operating system files")  
		       porém pode exibir hidden files, para todos os usuários inclusive cronostech 
		       (marcar "Show hidden files, folders, and drives")
		  (ii) Verificar se o diretório "Arquivos de Programas PC" ficou invisível no Windows Explorer como deveria


   17. Na sp dbo.monitorarIntegracaoFornecedores: 
      (i)  adicionar: 
                --and (@incremental_15min = 0 OR f.id_fornecedor_fornec <> xxx) -- AAAAAAAAAA
	       depois de: 
			    --and (@incremental_15min = 0 OR f.id_fornecedor_fornec <> 385) -- Walmart
   
      (ii) adicionar:
				  or @fornecedor_id = xxx -- AAAAAAAAA ainda não está em produção 
	       depois de: 
				  or @fornecedor_id = 385 -- Walmart ainda não está em produção 

           (Dica: pesquisar o texto "Para facilitar a manutenção deste if" nesta sp).

      
   18. Atualizar o arquivo integr-fornecedor-x.y.z.jar no servidor que está hospedando 
       o serviço de monitoramento para evitar o erro que o idFornecedor novo não existe
       no FornecedorRepositorio.getFornecedor()
       
       
   19. Executar o seguinte em todas as bases de produção, homologação, e cópias da base de produção:
   
       update [dbo].[Usuario_Sistema]  
          set id_fornecedor_fornec = .....
	        , id_perfil_acesso_perace = 14
	        , id_central_compra_ctrcom = null
	        , id_comprador_compr = null
        where cd_usuario_sistema_ususis = 'ericcoringa'
   
   
   20. (i) Conectar nas telas do Portal Cronos (produção - 80) logado como ericcoringa e verificar se eles usam 
           um texto padrão do fornecedor para todas as cotações de todos os compradores 
           e preencher isso no parâmetro "ObsOfertasPadraoSeNaoTemNoSistema".
           
       (ii) Depois disso voltar ericcoringa APENAS na base de produção: 

		update [dbo].[Usuario_Sistema]  
		   set id_fornecedor_fornec = null
		     , id_perfil_acesso_perace = 1
		     , id_central_compra_ctrcom = 1
		     , id_comprador_compr = null
		 where cd_usuario_sistema_ususis = 'ericcoringa'
    
    
   21. Enviar Email/ Skype: 
   
       Vocês têm apenas UMA base de dados WinThor/Oracle? Ou talvez tem uma base de produção e outra base de teste, por exemplo?

       É melhor usar logo a base de produção

       Qual é o endereço IP, porta, SID, usuário e senha do banco Oracle de produção? A porta é a porta "default" (1521) ?
       Pode ser um usuário que tem apenas privilêgio para consulta, pois o Portal Cronos precisa apenas consultar o estoque e os preços dos produtos e alguns dados dos clientes e não faz nenhuma alteração de nenhum dado no WinThor.

       Se precisar: você tem um arquivo "tnsnames.ora" em alguma máquina que está com o WinThor instalado? Coloca o conteúdo no Skype: neste arquivo dá para ver se o SID é WINT ou PROD

       Se o DBA demorar demais para criar um usuário novo, não podemos usar um dos usuários Oracle que já existe? Com certeza deve existir pelo menos um. Eu posso até colocar a senha deste usuário no arquivo de parâmetros do Portal Cronos de forma criptografada. 

	   Criptografei a senha do usuário do banco Oracle/Firebird/etc no arquivo de configuração da integração para impossibilitar comprometimento de segurança.
       

Este usuário está dando erro "ORA-00942: a tabela ou view não existe" então este usuário não tem privilégios suficientes.
Sugiro conectar no SQL Navigator ou outra ferramenta com este usuário para ver se este usuário consegue visualizar pelo menos uma tabela ou nenhuma


Leão explicou os parâmetros no arquivco de configuração? (por exemplo "UsarValorMinimoSistemaFornecedor" = "true"/"false", "CriterioVerificacaoEstoque" = "QtdEstoqueMaiorZero"/""QtdEstoqueMaiorOuIgualQtdSolicitada", etc)

OK, a parte técnica da instalação está concluída. Vou falar com Leão para continuar os próximos passos
       
Outra dúvida: os vendedores querem qual das seguintes opções?
1. que o WinThor envia automaticamente os preços ofertados de TODOS os produtos solicitados para o Portal Cronos mesmo no caso que o estoque de alguns produtos estiver zerado no WinThor? 
2. ou apenas os preços dos produtos solicitados que tiverem pelo menos 1 produto no estoque no WinThor?
3. ou apenas os preços dos produtos solicitados que tiverem uma quantidade no estoque no WinThor maior ou igual à quantidade solicitada?            

Exemplos de vantagens / desvantagens:
por exemplo uma possível desvantagem da opção 1: se o cliente escolher a SOST para fornecer alguns produtos e mandar uma ordem de compra, o risco é que vocês não vão conseguir cumprir o pedido ou apenas parcialmente
por exemplo uma possível desvantagem da opção 2 ou 3: no caso que o estoque da SOST não está sendo informado no WinThor, pode acontecer que a SOST vai perder oportunidades de vendas porque a integração automática vai deixar de ofertar produtos       
       

       No caso que os vendedores escolham fora do padrão (2): Todos os vendedores concordam com esta escolha?
        
       ANTIGO: Terminei minha parte da instalação. Favor verificar e salvar as seguintes chaves no arquivo de configuração que já está aberto no servidor atualmente: EnderecoIpServidorBancoDeDados, InstanciaBancoDeDados, UsuarioBancoDeDados, SenhaBancoDeDados, VerificarEstoque, CriterioVerificacaoEstoque, ObsOfertasPadraoSeNaoTemNoSistema, UsarValorMinimoSistemaFornecedor
    

   22. Criptografar a senha do usuário do banco Oracle/Firebird/etc no arquivo de configuração
       e alterar SenhaBancoDeDadosCriptografada = false -> true.
   
   23. Apenas no caso que já tem outro Java instalado no mesmo servidor para outro sistema,
       colocar o seguinte no Skype: 
       No caso que você precisa atualizar a versão de Java um dia no futuro, 
       no servidor que está hospedando a integração WinThor / PCronos, 
       favor não se esquecer para me avisar com alguns dias de antecedência! 
       Caso contrário, o Integrador WinThor/PCronos vai parar de funcionar alguns dias! 
       
   24. Copiar o arquivo /conf/xxx.properties do diretório de backups no projeto Eclipse para o servidor
       do fornecedor C:\Arquivos de Programas PC\Integração Fornecedor - Portal Cronos\conf\
 
   25. No caso que a TI do fornecedor geralmente usa uma máquina virtual para dar acesso remoto etc 
       (exemplo: Comal), pedir a TI conectar com um usuário desta máquina virtual para ver: 
       		- se o manual aparece no menu de Windows
       		- se consegue editar o arquivo de configuração
       		
   26. Testar as ofertas automáticas conectando nas telas do Portal Cronos (homologação - 81) logado como ericcoringa
   
       - Se acontecer o seguinte erro: 
       		"Cotação 101-0249 não ofertada! O Valor Mínimo para Entrega para a empresa compradora 
       		 XXXXXXXX não pode ser nulo ou em branco no sistema WinThor do fornecedor Propão, 
       		 pois a configuração "UsarValorMinimoSistemaFornecedor" = "true". Valores permitidos: 
       		 (R$) 0,00 ou um valor > 0."
       	 fazer o seguinte: 	 
             (i)   alterar "UsarValorMinimoSistemaFornecedor" logo para "false" para testar logo novamente
             (ii)  executar item 28 abaixo 
	         (iii) e confirmar com Leão se isso estava correto:
	                   "Leão, alterei a chave "UsarValorMinimoSistemaFornecedor" para "false" 
	                    para o fornecedor XXXXX. Favor confirmar se isso está correto no caso deste fornecedor"
       		
   
   27. Verificar, e no caso, enviar o seguinte email: 
   
Leão,
  
   você tem um script pronto para corrigir os caminhos nas base de homologação nova 
[BKP_PCronos_Producao_2018.02.21].[dbo].[Configuracao]?
Pois o servidor da SOST está apontando para o ambiente de homologação e a tabela 
dbo].[Configuracao está apontando para o ambiente de produção. 
Assim o serviço das ofertas da SOST nunca vai poder funcionar pois o site de homologação 
não tem privilêgio para gravar no site de produção então vai dar erro fatal, 
sem nenhum registro de log deste erro... 
 
Eric
   
   
28. No caso se precisar de re-processamento de cotações ofertadas erradamente, 
    ou não ofertadas indevidamente, executar o seguinte na base de homologação:

		delete from dbo.Log_Erro_Integracao
		delete from dbo.Integracao_Cotacao_Fornecedor
    
         
29. Apenas no caso que o servidor é de tipo Windows 10 Pro: 
    registrar as seguintes atividades daqui há 3 meses para ver se o JRE trava com todos os servidores Windows 10 
    ou apenas na JR Distribuição: 
       
    (i) Dependendo dos resultados, substituir no Integrador - método main() o seguinte:
          if (     fRep.getFornecedor(fRep.getIdFornecedorByCnpj(cnpjFornecedor)).tipoSO.equals("Windows 10 Pro")
        		&& fRep.getFornecedor(fRep.getIdFornecedorByCnpj(cnpjFornecedor)).IdFornecedor == 947
             )

        por:
          if (     fRep.getFornecedor(fRep.getIdFornecedorByCnpj(cnpjFornecedor)).tipoSO.equals("Windows 10 Pro")
             )
       
        ou por:
          if (     fRep.getFornecedor(fRep.getIdFornecedorByCnpj(cnpjFornecedor)).IdFornecedor == 947
             )
             
             
    (ii) Dependendo dos resultados, substituir no ManualManutencao.java - constructor ManualManutencao(Fornecedor f) o seguinte:
		if ( !(    f.tipoSO.equals("Windows 10 Pro")
			    && f.IdFornecedor == 947
      		)
   		)

        por:
             ........

        ou por:
             ........


   (iii) No caso que travamento acontece com todos os servidores Windows 10:
           - No Instalador criar o novo arquivo Integração Portal Cronos - Fornecedor.Windows.10_Pro.TaskSchedule.xml: 
             	- no Windows Task Scheduler > Propriedades > Configurações: alterar o último combobox 
             	  de "Interromper a instância existente" para "Não iniciar uma nova instância"
             	   
           - Parametrizar "Windows 10 Pro" no Instalador
       
       
    (iv) No caso que travamento acontece com todos os servidores Windows 10:
    		- Fazer o seguinte manualmente no servidor que também está sofrendo travamentos, 
    		  ou colocar o seguinte no "Manual Upgrade Ambientes de Produção de x1.y1.z1 para x2.y2.z2.txt":

			x1. Apenas no caso de instalação no servidor da <Nome_Fornecedor>:
	     			- no Windows Task Scheduler > Propriedades > Configurações: alterar o último combobox 
	       	  		  de "Interromper a instância existente" para "Não iniciar uma nova instância"


			x2. Apenas no caso de instalação no servidor da <Nome_Fornecedor>:
					- No Manual TI apagar o seguinte manualmente: 
						  - No "Gerenciador de Tarefas" ("Task Manager") ordenar por nome do processo, e procurar 
						    "Java(TM) Platform SE binary". 
						    Se não tiver nenhum processo com este nome, tudo está certo.   
						    Se tiver um ou mais processos na lista, verifica com o botão á direita do mouse, 
						    na aba "Geral" se o "Local" de cada processo for igual a "C:/"Program Files"/Java/jre1.8.0_92/bin/java.exe". 
						    Se não tiver nenhum processo com este "Local", tudo está certo.   
						    Se tiver um processo com este "Local" enquanto que as ofertas automáticas estão paradas, 
						    este processo está travado. Neste caso, com o botão a direita do mouse clicar em "Finalizar tarefa".  
						    Se tiver um processo com este "Local" enquanto que as ofertas automáticas estão processando 
						    normalmente, tudo está certo e não mexe com este processo.   
 
