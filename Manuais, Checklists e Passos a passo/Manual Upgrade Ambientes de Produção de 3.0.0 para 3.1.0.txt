Manual Upgrade dos Ambientes de Produção de 3.0.0 para 3.1.0 
============================================================

1. (i)  Apenas no caso do servidor do monitoramento:
		 - Conectar como cronostech
	     - No Windows Explorer alterar a opção para exibir arquivos de sistema 
	       (desmarcar "Hide protected operating system files") temporariamente

	(ii) Em todos os servidores dos fornecedores:
	      - Verificar se o usuário logado é administrador ou administrator, 
	        local ou da rede, abrindo e fechando cmd.exe (como administrador da rede ainda não foi testado).
	        (Formaggio: user "techcorp")
	      
	      
2. Fazer exatamente na seguinte sequência, exceto no APS Cloud:
   (i)   Em todos os casos exceto JR Distribuição / Windows 10:
         Verificar se o arquivo .bat e o .jar atual estão em uso: 
         verificar o horário da última e da próxima execução no Task Scheduler 
         e verificar no taskmgr.exe se o JRE está rodando ainda. 
         Esperar até o JRE terminou.
   
   (ii)  Em todos os casos (incluindo no caso JR Distribuição / Windows 10):
 		   - Adicionar "exit" seguida por uma linha em branco no início do arquivo 
 		     Job15a15minOfertamentoJava_Windows.bat no servidor do fornecedor. 
 		     (NÃO renomear Job15a15minOfertamentoJava_Windows.bat para evitar que o Scheduler 
              possivelmente se perde comprometendo os derrubamentos automáticos dos JRE´s travados)

   (iii) Apenas no caso de instalação no servidor da JR Distribuição (Windows 10):
	        a. Primeiro verificar no diretório C:\ProgramData\PortalCronos\Logs\Local\ 
	           se o Integrador está ofertando no momento e ficar esperando até ele terminar 
	           o último passo (a atualização do arquivo TemposExecução.log)
 
		    b. Matar o processo JRE 1.8.0_92
		 		 
		   
3. Em todos os servidores exceto no APS Cloud (pois para o APS Cloud será zippado mais tarde):
   (i)  Copiar o arquivo novo integr-fornecedor-3.1.0.jar do instalador para o servidor do fornecedor.
   (ii) Apagar a versão anterior integr-fornecedor-*.*.*.jar.
 
 
4. Em todos os servidores exceto no APS Cloud (pois para o APS Cloud será zippado abaixo):
         - Atualizar os seguintes arquivos no servidor do fornecedor:
   				- bin\Versao.bat -> 3.1.0
   				- bin\VerificarUsuarioAdministrador.bat
   				- bin\CaminhoJRE.bat
   				- bin\Inicializacoes.bat
   				- bin\Desinstalador.bat
   				- UpgradeNaoNuvem3.1.0.bat
	        	- Desinstalar_Integração_Fornecedor_PortalCronos.bat
   				- Job15a15min.bat 
   					- Adicionar "exit" novamente no início do arquivo

5. Em todos os servidores: 
          - Remover os seguintes arquivos:
        		- Job15a15minOfertamentoJava_Windows.bat
        		- Job15a15minOfertamentoJava.log
   
   
6. Em todos os servidores exceto no APS Cloud: 
   		    - Abrir o Agendador de Tarefas de Windows e verificar o minuto atual do agendamento, 
   		      e verificar se bate com o relatório RelatorioHorasIniJobsFornecedores.launch, 
   		      coluna "Minuto Atual"
   		 
   		 	- Executar UpgradeNaoNuvem3.1.0.bat como Administrador
   		 		- No caso do servidor de monitoramento digitar -1 na pergunta do ID do fornecedor
   		 	
 			- Depois disso abrir o Agendador de Tarefas de Windows e verificar:
 			    (a.) se o minuto do agendamento, 
 			         gerado por este patch automatizado acima, 
 			         bate com o relatório RelatorioHorasIniJobsFornecedores.launch, 
 			         coluna "Minuto v 3.1.0 e maior"
 			         
 			    (b.) Verificar se o novo renomeado "Job15a15min.bat" é chamado 
 			         ao invés do antigo "Job15a15minOfertamentoJava_Windows.bat"

 
 
7. Em todos os casos: (ainda não feito no servidor de monitoramento!!!!!) 
      - substituir mslinks 1.0.4 por 1.0.5??????
      - annotations.jar????
       
 
8. Apenas no servidor do APS Cloud (???????????????????? verificar todos os detalhes abaixo....................):
   a. Zippar os seguintes arquivos para o arquivo PatchNuvem.3.1.0.zip:
       	    - bin\Versao.bat 
	   		- bin\VerificarUsuarioAdministrador.bat
			- bin\CaminhoJRE.bat
			- bin\Inicializacoes.bat
			- bin\Desinstalador.bat
   			- Job15a15min.bat
        	- integr-fornecedor-3.1.0.jar
        	- AdicionarFornecedorNuvem.bat
        	- RemoverFornecedorNuvem.bat
        	- Desinstalar_Integração_Fornecedor_PortalCronos.bat
 
   b. Copiar o arquivo zip para o diretório C:\Eric\ no servidor do APS Cloud.
   
   c. Ajeitar os start-dates das Task Schedules da Marizpan e da Atacamax, etc, da seguinte forma: 
   		  (i)    Backup dos configs da Marizpan, Atacamax, e de todos os outros fornecedores
          (ii)   Abrir o Agendador de Tarefas de Windows e verificar o minuto atual dos agendamentos, 
   		         e verificar se batem com o relatório RelatorioHorasIniJobsFornecedores.launch, 
   		         coluna "Minuto Atual"
   		  (iii)  Remover todas as instâncias (primeiro esperar até o processo da instância terminoou)
   		  (iv)   Instalar os arquivos novos listados no item (a) acima 
   		  (v)    Clicar em "Adicionar instância" para todos os fornecedores
   		  (vi)   Verificar os Start Times novos de todos eles no Task Scheduler: 
   		         verificar se os minutos dos agendamentos novos batem com o relatório 
   		         RelatorioHorasIniJobsFornecedores.launch, coluna "Minuto Futuro"
   		  (vii)  Verificar se o novo renomeado Job15a15min.bat é chamado
   		  (viii) Ajeitar os ícones no menu de Windows manualmente (no caso que isso não foi automatizado ainda)
   		  
   
9. Em todos exceto no APS Cloud:
   Remover "exit" e a linha em branco no início do arquivo Job15a15min.bat
   no servidor do fornecedor (Sempre como último passo no AnyDesk para forçar 100 % conclusão do upgrade).

10. Em todos os casos: 
      - Acompanhar 15 minutos se o Integrador começa executar automaticamente
      - Verificar se o Integrador gerou o novo arquivo:
     		- Job15a15min.%1.log no caso do servidor do APS Cloud
     		- Job15a15min.log    em todos os outros casos
     
11. Apenas no caso do servidor do monitoramento: 
     (i)  No Windows Explorer voltar a opção para não exibir arquivos de sistema 
          (marcar "Hide protected operating system files")
     (ii) Fechar o Windows Explorer e abrir novamente
     
     
12. (i)   Atualizar a versão do .jar no arquivo "FornecedorRepositorio.java" para o fornecedor que foi atualizado
    (ii)  Compilar o arquivo .jar
    (iii) Atualizar o arquivo .jar no servidor de monitoramento (não precisa atualizar o servidor do fornecedor)
          esperando o processamento atual terminar primeiro
   
